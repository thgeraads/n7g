<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>iPod UI Preview</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <!--OpenGraph tags-->

    <meta property="og:title" content="iPod Nano 7 Theme Previewer">
    <meta property="og:description" content="Preview and test iPod Nano 7 themes with this interactive tool.">
    <meta property="og:image" content="https://raw.githubusercontent.com/thgeraads/n7g/refs/heads/main/n7g_theme_previewer/assets/graphic_space_gray.svg">
    <meta property="og:url" content="https://thgeraads.github.io/n7g/n7g_theme_previewer/">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="nano.zeehondie.net">

    <style>

        a {
            text-decoration: none;
            color: inherit;
        }

        * {
            font-family: "Apple Gothic Regular", "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
        }

        /* open-sans-regular - latin */
        @font-face {
            font-display: swap; /* Check https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/font-display for other options. */
            font-family: 'Open Sans';
            font-style: normal;
            font-weight: 400;
            src: url('./fonts/open-sans-v43-latin-regular.woff2') format('woff2'); /* Chrome 36+, Opera 23+, Firefox 39+, Safari 12+, iOS 10+ */
        }

        @font-face {
            font-display: swap; /* Check https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/font-display for other options. */
            font-family: 'Open Sans';
            font-style: normal;
            font-weight: 500;
            src: url('./fonts/open-sans-v43-latin-500.woff2') format('woff2'); /* Chrome 36+, Opera 23+, Firefox 39+, Safari 12+, iOS 10+ */
        }


        @font-face {
            font-family: "Apple Gothic Regular";
            font-style: normal;
            font-weight: 400;
            /*src: url('https://ipswproxy.zeehondie.net/?url=https://github.com/justrajdeep/fonts/raw/refs/heads/master/AppleGothic.ttf') format('truetype'); !* Chrome 36+, Opera 23+, Firefox 39+, Safari 12+, iOS 10+ *!*/
        }

        html, body {
            margin: 0;
            padding: 0;
            background: radial-gradient(#d2d4e4, #d5d6e6);
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            /*align-items: center;*/
        }

        h2 {
            margin: 16px 0 8px;
        }

        input {
            margin-bottom: 12px;
        }

        .ipod-wrapper {
            width: 240px;
            height: 432px;
            position: relative;
            overflow: hidden;
            border: 2px solid #000;
            background-size: cover;
            background-position: center;
            background-color: white;

        }

        .status-bar {
            height: 27px;
            /*background-image: url("assets/statusbar_wallpaper.jpg");*/
            display: flex;
            /*background: rgba(0, 0, 0, 0.5);*/
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
            text-shadow: 0 0 50px rgba(0, 0, 0, 1), 1px 1px 3px rgba(0, 0, 0, 0.6);
        }

        .pages-wrapper {
            height: calc(100% - 27px);
            display: flex;
            transition: transform 0.3s ease;
        }

        .page {
            margin-top: 7px;
            height: 369px;
            min-width: 240px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            /*align-items: center;*/
            justify-items: center;
            /*padding-top: 10px;*/
            box-sizing: border-box;
        }

        .app {
            display: flex;
            text-align: center;
            flex-direction: column;
            /*justify-content: center;*/
        }

        .app img {
            width: 112px;
            height: 112px;
            user-select: none;
        }

        .app p {
            margin-top: -8px;
            margin-bottom: 0;
            font-size: 13px;
            font-weight: bold;
            color: white;
            user-select: none;
            /*    large shadow*/
            text-shadow: 0 0 50px rgba(0, 0, 0, 1), 1px 0px 1px rgba(0, 0, 0, 0.6);
        }

        .container {
            padding: 2rem;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            /*width: 90svw;*/

        }

        .pagination {
            position: absolute;
            bottom: 10px;
            width: 100%;
            text-align: center;
        }

        .dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            margin: 0 3px;
            background-color: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
        }

        .dot.active {
            background-color: white;
        }

        .controls {
            margin-top: -26px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .colors {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
            margin-bottom: 10px;
        }

        .btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 0 4px rgba(0, 0, 0, 0.3);
        }

        .wallpaperScreen {
            width: 240px;
            /*background: rgba(0, 0, 0, 0.2);*/
            padding: 10px;
            border-radius: 10px;
            display: flex;
            justify-content: center;
        }

        #wallpaperOptions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
        }

        .wallpaperScreenWallpapers img {
            width: 117px;
            height: 200px;
            margin: 4px;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .wallpaperScreenWallpapers img.active {
            border: 2px solid #ffcc00;
        }

        .navbar {
            height: 96px;
            width: 100%;
            background-color: #8f909b80;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
        }

        .navbar > p {
            color: #3a3c45;
            font-family: 'Open Sans', sans-serif;
            font-weight: 500;
            letter-spacing: -0.5px;
            font-size: 28px;
            padding: 28px;
        }


        @keyframes mde3-btn-hover {
            0% {
                width: 200px;
            }

            50% {
                width: 220px;
            }

            100% {
                width: 200px;
            }

        }

        .md3e-btn {
            height: 60px;
            /*width: 200px;*/
            padding: 0 20px;
            /*padding: 20px 30px;*/
            background-color: #8f909b80;
            color: #3a3c45;
            border-radius: 30px;
            display: flex;
            /*gap: 8px;*/
            align-items: center;
            justify-content: center;
            /*justify-content: center;*/
            transition: all 0.3s ease;
            font-size: 18px;
            font-family: 'Open Sans', sans-serif;

        }


        .md3e-btn:hover {
            background-color: #4f5d8c;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            /*animation-name: mde3-btn-hover;*/
            animation-duration: 0.2s;
            animation-timing-function: ease-in-out;
            /*transition: background-color 0.3s ease, color 0.3s ease;*/
        }

        .md3e-btn:hover .button-content > svg {
            fill: white;
            stroke: white;
        }

        .button-content > svg {
            transition: all 0.3s ease;

        }

        .button-content {
            display: flex;
            flex-direction: row;
            justify-content: center;
            gap: 6px;
            align-items: center;
            margin-right: 3px;
        }

        .err {
            background-color: #ec696080;
        }

        .err:hover {
            background-color: #ac403a;
            color: #FFFFFF;
        }

        .button-group {
            display: flex;
            flex-direction: row;
            gap: 10px;
            margin-right: 20px;
        }

        .dropdown-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-right: 20px;
            align-items: center;
        }


        .color-preview {
            width: 24px;
            height: 24px;
            border-radius: 25px;
            display: inline-block;
            margin-right: 8px;
            vertical-align: middle;
        }

        .slate {
            background-color: #4f5864;
        }

        .silver {
            background-color: #ecf0ef;
        }

        .blue {
            background-color: #45bdd8;
        }

        .green {
            background-color: #70c093;
        }

        .yellow {
            background-color: #d7dc48;
        }

        .pink {
            background-color: #f47578;
        }

        .purple {
            background-color: #cf91cc;
        }

        .red {
            background-color: #f33a3d;
        }

        .color-preview.blank {
            height: 0;
        !important;
            width: 0;
        !important;
            background-color: transparent;
            padding: 0;
            margin: 0;
        }

        .dropdown-item > div > span {
            align-items: center;
            margin-left: 30px
        }

        .footer {
            width: 100%;
            height: auto;
            padding: 2px;
            position: fixed;
            bottom: 0;
            background-color: #8f909b80;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            font-family: 'Open Sans', sans-serif;
            font-weight: 500;
            letter-spacing: -0.5px;
            font-size: 12px;

            & > a {
                color: #606470;
                /*text-decoration: none;*/
            }
        }

        .modal {
            animation: fadeIn 0.2s ease-out;
        }

        .upload-title {
            margin-top: 0;
        }


        .modal-content {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
            width: 90%;
            gap: 20px;

            > svg {
                transform: scale(1.4);
                fill: #4f5d8c;
                stroke: #4f5d8c;
            }
        }

        .modal-text-content {
            display: flex;
            flex-direction: column;
            gap: 5px;

            & > div:last-child {
                font-size: 12px !important;
                color: #606470;
            }
        }

        .custom-file-upload {
            display: inline-block;
            padding-top: 20px;
            padding-bottom: 20px;
            font-size: 18px;
            font-weight: 500;
            width: 100%;
            color: #333;
            background-color: #ffffff;
            border: none;
            border-radius: 25px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            text-align: center;
            transition: background-color 0.3s ease;
        }

        .custom-file-upload:hover {
            background-color: #f0f0f0;
        }

        #fileInput {
            display: none;
        }

        .upload-wrapper {
            /*background-color: white;*/
            /*padding: 25px;*/
            /*border-radius: 25px;*/
            text-align: center;
            margin: 0 0 20px 0px;
            width: 100%;
        }

        .upload-title {
            font-size: 24px;
            font-weight: normal;
            margin: 0 0 15px 0px;
            color: #3a3c45;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translate(-50%, -45%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }

        .sim {
            justify-self: end;
        }


    </style>
    <link rel="stylesheet" href="dropdown.css">
</head>
<body>
<div class="navbar">
    <p>iPod Nano 7 Theme Previewer</p>
    <div class="button-group">
        <a href='https://github.com/thgeraads/n7g/issues/new' class="md3e-btn err">
            <div class="button-content">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                     fill="#1f1f1f">
                    <path d="M480-200q66 0 113-47t47-113v-160q0-66-47-113t-113-47q-66 0-113 47t-47 113v160q0 66 47 113t113 47Zm-80-120h160v-80H400v80Zm0-160h160v-80H400v80Zm80 40Zm0 320q-65 0-120.5-32T272-240H160v-80h84q-3-20-3.5-40t-.5-40h-80v-80h80q0-20 .5-40t3.5-40h-84v-80h112q14-23 31.5-43t40.5-35l-64-66 56-56 86 86q28-9 57-9t57 9l88-86 56 56-66 66q23 15 41.5 34.5T688-640h112v80h-84q3 20 3.5 40t.5 40h80v80h-80q0 20-.5 40t-3.5 40h84v80H688q-32 56-87.5 88T480-120Z"/>
                </svg>
                <span>Report an issue</span>
            </div>
        </a>

        <a href="https://github.com/thgeraads/n7g/issues/new" class="md3e-btn">
            <div class="button-content">

                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                     fill="#1f1f1f">
                    <path d="M320-240 80-480l240-240 57 57-184 184 183 183-56 56Zm320 0-57-57 184-184-183-183 56-56 240 240-240 240Z"/>
                </svg>
                <span>Request a feature?</span>
            </div>
        </a>
    </div>
</div>
<div class="container">

    <div class="dropdown-group">
        <div class="dropdown" id="firmware-dropdown">
            <div class="dropdown-toggle" tabindex="0" id="firmwareDropdownToggle">Select a firmware</div>
            <div class="dropdown-menu" id="firmwareDropdownMenu">
            </div>
        </div>

        <p>- or -</p>

        <div class="upload-wrapper">
            <label for="fileInput" class="custom-file-upload">Upload .IPSW</label>
            <input type="file" id="fileInput" accept=".ipsw">
        </div>

        <div class="dropdown" id="color-dropdown">
            <div class="dropdown-toggle" tabindex="0" id="colorDropdownToggle">
                <div class="color-preview blank"></div>
                Select a device color
            </div>
            <div class="dropdown-menu" id="colorDropdownMenu">
                <div class="dropdown-item">
                    <div class="color-preview slate"></div>
                    <span>Slate</span></div>
                <div class="dropdown-item">
                    <div class="color-preview silver"></div>
                    <span>Silver</span></div>
                <div class="dropdown-item">
                    <div class="color-preview blue"></div>
                    <span>Blue</span></div>
                <div class="dropdown-item">
                    <div class="color-preview green"></div>
                    <span>Green</span></div>
                <div class="dropdown-item">
                    <div class="color-preview yellow"></div>
                    <span>Yellow</span></div>
                <div class="dropdown-item">
                    <div class="color-preview pink"></div>
                    <span>Pink</span></div>
                <div class="dropdown-item">
                    <div class="color-preview purple"></div>
                    <span>Purple</span></div>
                <div class="dropdown-item">
                    <div class="color-preview red"></div>
                    <span>Red</span></div>

            </div>
        </div>


    </div>

    <div class="sim">


        <div class="ipod-wrapper" id="ipod">
            <div class="status-bar">

            </div>
            <div class="pages-wrapper" id="pagesWrapper"></div>
            <div class="pagination" id="paginationDots"></div>
        </div>
    </div>


    <div class="controls">
        <div class="colors" id="colorButtons">

        </div>
        <div class="wallpaperScreen">
            <div class="wallpaperScreenWallpapers" id="wallpaperOptions"></div>
        </div>
    </div>
</div>

<div class="footer">
    <a href="https://github.com/thgeraads/n7g/n7g_theme_previewer">iPod Nano 7 Theme Previewer</a>
    <p></p>
</div>

<!-- Include FFLATE support -->
<script src="https://unpkg.com/fflate@0.8.2"></script>
<script src="https://cdn.jsdelivr.net/npm/fflate@0.8.2/umd/index.js"></script>

<!-- Main script -->
<script type="module">
    import {extractFilteredImages} from './js/unpack.js';
    import {json} from './js/json.js';

    let ipswLoaded = false

    const fileInput = document.getElementById('fileInput');
    const pagesWrapper = document.getElementById('pagesWrapper');
    const paginationDots = document.getElementById('paginationDots');
    const ipod = document.getElementById('ipod');
    const colorButtons = document.getElementById('colorButtons');
    const wallpaperOptions = document.getElementById('wallpaperOptions');

    let imageMap = new Map();
    let selectedColor = 'Green';
    let selectedStyle = 'solid';
    let currentPage = 0;
    let pagesCount = 0;
    let isDragging = false;
    let startX = 0;
    let currentTranslate = 0;
    let prevTranslate = 0;
    let lastFilteredImages = [];

    fileInput.addEventListener('change', async (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const buffer = await file.arrayBuffer();
        await processIPSW(buffer);
    });

    const firmwareJson = fetch("/n7g_theme_previewer/assets/firmwares.json")
        .then(response => response.json())
        .then(data => {
            const firmwareDropdownMenu = document.querySelector('#firmwareDropdownMenu');
            firmwareDropdownMenu.innerHTML = '';
            data.forEach(firmware => {
                const item = document.createElement('div');
                item.className = 'dropdown-item';
                if (firmware.author) {
                    item.textContent = firmware.author + '/' + firmware.name;
                } else {
                    item.textContent = firmware.name;
                }
                // item.textContent = firmware.name;
                item.addEventListener('click', async () => {
                    createModal("Loading IPSW...", "(this may take a while)");
                    const directURL = firmware.url;
                    const proxyURL = `https://ipswproxy.zeehondie.net/?url=${encodeURIComponent(directURL)}`;
                    try {
                        let response = await fetch(directURL);
                        if (!response.ok) throw new Error("Direct fetch failed");
                        const buffer = await response.arrayBuffer();
                        await processIPSW(buffer);
                    } catch (directErr) {
                        try {
                            const proxyResponse = await fetch(proxyURL);
                            if (!proxyResponse.ok) throw new Error("CORS proxy fetch failed");
                            const buffer = await proxyResponse.arrayBuffer();
                            await processIPSW(buffer);
                        } catch (proxyErr) {
                            alert(`Error loading firmware:\n${proxyErr.message}`);
                        }
                    }
                });
                firmwareDropdownMenu.appendChild(item);
            });
        });

    async function processIPSW(buffer) {
        const images = await extractFilteredImages(buffer, json);
        lastFilteredImages = images;
        imageMap.clear();
        for (const img of images) {
            const idPrefix = img.id.toString();
            const url = img.dataURL;
            if (!imageMap.has(idPrefix)) imageMap.set(idPrefix, []);
            imageMap.get(idPrefix).push(url);
        }
        updateWallpaper();
        renderWallpaperOptions();
        renderAppIcons();
        closeModal();
        updateStatusBarTime()
        ipswLoaded = true;
        renderWallpaperOptions();
    }

    function updateWallpaper() {
        const wallId = json.wallpapers_by_color[selectedColor]?.[selectedStyle]?.full_res;
        const wallpaper = findImageById(wallId);
        if (wallId && wallpaper) {
            ipod.style.backgroundImage = `url(${wallpaper})`;
        }
    }

    function renderWallpaperOptions() {
        if (!ipswLoaded) return;
        wallpaperOptions.innerHTML = '';
        const group = json.wallpapers_by_color[selectedColor];
        Object.entries(group).forEach(([styleName, entry]) => {
            const img = document.createElement('img');
            img.src = findImageById(entry.preview);
            img.alt = styleName;
            if (styleName === selectedStyle) img.classList.add('active');
            img.onclick = () => {
                selectedStyle = styleName;
                updateWallpaper();
                renderWallpaperOptions();
            };
            wallpaperOptions.appendChild(img);
        });
    }

    function renderAppIcons() {
        const visibleApps = json.app_icons.filter(a => !(a.notes && a.notes.includes('unused')));
        const appsPerPage = 6;
        pagesCount = Math.ceil(visibleApps.length / appsPerPage);
        pagesWrapper.innerHTML = '';
        paginationDots.innerHTML = '';
        for (let i = 0; i < pagesCount; i++) {
            const page = document.createElement('div');
            page.className = 'page';
            const apps = visibleApps.slice(i * appsPerPage, (i + 1) * appsPerPage);
            apps.forEach(app => {
                const appEl = document.createElement('div');
                appEl.className = 'app';
                const img = new Image();
                img.src = findImageById(app.id);
                img.alt = app.name;
                img.width = 112;
                img.height = 112;
                const label = document.createElement('p');
                label.textContent = app.name;
                appEl.appendChild(img);
                appEl.appendChild(label);
                page.appendChild(appEl);
            });
            pagesWrapper.appendChild(page);
            const dot = document.createElement('span');
            dot.className = 'dot' + (i === 0 ? ' active' : '');
            paginationDots.appendChild(dot);
        }
        currentPage = 0;
        currentTranslate = 0;
        prevTranslate = 0;
        updateSlider();
    }

    function updateSlider() {
        pagesWrapper.style.transform = `translateX(${-240 * currentPage}px)`;
        Array.from(paginationDots.children).forEach((dot, idx) => {
            dot.classList.toggle('active', idx === currentPage);
        });
    }

    function findImageById(id) {
        console.log(id);
        const prefix = id.split('_')[0];
        return imageMap.get(prefix)?.[0] || '';
    }

    function getApproxColor(name) {
        const c = name.toLowerCase();
        if (c.includes('gray') || c.includes('slate')) return '#444';
        if (c.includes('red')) return '#c70007';
        if (c.includes('green')) return '#5bad53';
        if (c.includes('yellow')) return '#bfbf00';
        if (c.includes('blue')) return '#008a96';
        if (c.includes('purple')) return '#bf6d93';
        if (c.includes('pink')) return '#f76a52';
        if (c.includes('silver')) return '#aaaaaa';
        if (c.includes('gold')) return '#d4af37';
        return '#777';
    }

    function createModal(text, subtext = '') {
        const overlay = document.createElement('div');
        overlay.className = 'modal-overlay';
        Object.assign(overlay.style, {
            position: 'fixed', top: '0', left: '0', width: '100vw', height: '100vh',
            background: 'rgba(0, 0, 0, 0.3)', backdropFilter: 'blur(4px)', zIndex: '999'
        });

        const modal = document.createElement('div');
        modal.className = 'modal';
        Object.assign(modal.style, {
            width: '250px', minHeight: '50px', display: 'flex', flexDirection: 'column',
            justifyContent: 'center', alignItems: 'center', position: 'fixed',
            top: '50%', left: '50%', transform: 'translate(-50%, -50%)',
            backgroundColor: '#fff', borderRadius: '25px', boxShadow: '0px 5px 15px rgba(0,0,0,0.3)',
            zIndex: '1000', overflow: 'auto', padding: '24px 18px', boxSizing: 'border-box',
            transition: 'opacity 0.2s ease'
        });

        modal.innerHTML = `
            <div class="modal-content" style="position: relative;">
                <div class="modal-text-content">
                    <div class="modal-body">${text}</div>
                    <div class="modal-body">${subtext}</div>
                </div>
                <svg width="24" height="24" stroke="#000" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <style>.spinner_V8m1{transform-origin:center;animation:spinner_zKoa 2s linear infinite}
                    .spinner_V8m1 circle{stroke-linecap:round;animation:spinner_YpZS 1.5s ease-in-out infinite}
                    @keyframes spinner_zKoa{100%{transform:rotate(360deg)}}
                    @keyframes spinner_YpZS{0%{stroke-dasharray:0 150;stroke-dashoffset:0}
                    47.5%{stroke-dasharray:42 150;stroke-dashoffset:-16}
                    95%,100%{stroke-dasharray:42 150;stroke-dashoffset:-59}}</style>
                    <g class="spinner_V8m1"><circle cx="12" cy="12" r="9.5" fill="none" stroke-width="3"></circle></g>
                </svg>
            </div>`;
        document.body.appendChild(overlay);
        document.body.appendChild(modal);
    }

    function closeModal() {
        document.querySelector('.modal')?.remove();
        document.querySelector('.modal-overlay')?.remove();
    }

    ipod.addEventListener('mousedown', startDrag);
    ipod.addEventListener('mousemove', drag);
    ipod.addEventListener('mouseup', endDrag);
    ipod.addEventListener('mouseleave', endDrag);
    ipod.addEventListener('touchstart', e => startDrag(e.touches[0]));
    ipod.addEventListener('touchmove', e => drag(e.touches[0]));
    ipod.addEventListener('touchend', e => endDrag(e.changedTouches[0]));

    function startDrag(e) {
        isDragging = true;
        startX = e.clientX;
        pagesWrapper.style.transition = 'none';
    }

    function drag(e) {
        if (!isDragging) return;
        const dx = e.clientX - startX;
        currentTranslate = prevTranslate + dx;
        pagesWrapper.style.transform = `translateX(${currentTranslate}px)`;
    }

    function endDrag(e) {
        if (!isDragging) return;
        isDragging = false;
        const movedBy = e.clientX - startX;
        if (movedBy < -50 && currentPage < pagesCount - 1) currentPage++;
        if (movedBy > 50 && currentPage > 0) currentPage--;
        currentTranslate = -240 * currentPage;
        prevTranslate = currentTranslate;
        pagesWrapper.style.transition = 'transform 0.3s ease';
        updateSlider();
    }

    document.addEventListener('DOMContentLoaded', () => {
        const dropdowns = document.querySelectorAll('.dropdown');
        dropdowns.forEach(dropdown => {
            const toggle = dropdown.querySelector('.dropdown-toggle');
            const menu = dropdown.querySelector('.dropdown-menu');
            const items = menu.querySelectorAll('.dropdown-item');

            toggle.addEventListener('click', () => {
                dropdowns.forEach(d => {
                    if (d !== dropdown) d.classList.remove('open');
                });
                dropdown.classList.toggle('open');
            });

            items.forEach(item => {
                item.addEventListener('click', () => {
                    toggle.textContent = item.textContent;
                    items.forEach(i => i.classList.remove('selected'));
                    item.classList.add('selected');
                    dropdown.classList.remove('open');
                });
            });

            toggle.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    dropdown.classList.toggle('open');
                }
            });
        });

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.dropdown')) {
                dropdowns.forEach(d => d.classList.remove('open'));
            }
        });

        const colorDropdownMenu = document.getElementById('colorDropdownMenu');
        for (const color of colorDropdownMenu.querySelectorAll('.dropdown-item')) {
            color.addEventListener('click', () => {
                const colorPreview = color.querySelector('.color-preview');
                if (colorPreview) {
                    console.log(`Selected color: ${colorPreview.className}`);
                    selectedColor = capitalizeFirstLetter(colorPreview.className.split(' ')[1]);
                    selectedStyle = 'solid';
                    updateWallpaper();
                    renderWallpaperOptions();
                }
            });
        }


        function capitalizeFirstLetter(val) {
            return String(val).charAt(0).toUpperCase() + String(val).slice(1);
        }

        // render status bar time


    });

    function updateStatusBarTime() {
        const statusBar = document.querySelector('.status-bar');

        const now = new Date();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');

        // convert to 12 hour AM/PM
        const ampm = hours >= 12 ? 'PM' : 'AM';
        const formattedHours = hours % 12 || 12; // convert 0 to 12 for 12-hour format
        statusBar.textContent = `${formattedHours}:${minutes} ${ampm}`;
    }

</script>


</body>
</html>
